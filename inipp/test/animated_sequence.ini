[DEFAULTS]
Input = HEADLIGHTS           ; what would trigger lights
EmissiveColor = 10, 10, 10   ; emissive color for those lights
EmissiveOffColor = 0         ; emissive off color
EmissiveLag = 0              ; emissive lag
SimulateHeating = 0          ; just in case, but diods don’t heat up
Steps = 10                   ; amount of lights in a chain, up to 40
NamePrefix = anim_light_     ; prefix of all glowing meshes
IndexOffset = 1              ; number of the first glowing mesh
StepOffset = 1
Location = NONE              ; change to FRONT to make lights break with front collisions
LoopTime = 2                 ; time in seconds for the whole loop to run
PaddingStart = 0.1           ; time in seconds before first bit starts glowing
PaddingEnd = 0.2             ; time in seconds between last bit starting glowing and loop being over
TransitionMult = 0.5         ; smoothness of lights turning on

[FUNCTION: AnimatedEmissiveLut]
ARGUMENTS = index, steps, padStart, padEnd, transitionMult
PRIVATE = 0
CODE='
  local space = (1 - padStart - padEnd) / (steps - 1)
  local x0 = padStart + index * space
  local x1 = padStart + (index + transitionMult) * space
  return "(| 0=0 | " .. x0 .. "=0 | " .. x1 .. "=1 | 1=1  |)" '

[MIXIN: _AnimatedEmissiveMixin]
@ACTIVE = $" $Steps > $Index and 1 or 0 "
NAME = $" $NamePrefix .. ($Index * $StepOffset + $IndexOffset) "
COLOR = $EmissiveColor
OFF_COLOR = $EmissiveOffColor
LAG = $EmissiveLag
SIMULATE_HEATING = $SimulateHeating
LOCATION = $Location
INPUT = $Input
BLINKING_PATTERN = $" AnimatedEmissiveLut($Index, $Steps, $PaddingStart / $LoopTime, $PaddingEnd / $LoopTime, $TransitionMult) "
BLINKING_DURATION = $LoopTime

[TEMPLATE: _AnimatedEmissivePart]
@OUTPUT = EMISSIVE_...
@MIXIN = _AnimatedEmissiveMixin

[_AnimatedEmissivePart] Index = 0
[_AnimatedEmissivePart] Index = 1
[_AnimatedEmissivePart] Index = 2
[_AnimatedEmissivePart] Index = 3
[_AnimatedEmissivePart] Index = 4
[_AnimatedEmissivePart] Index = 5
[_AnimatedEmissivePart] Index = 6
[_AnimatedEmissivePart] Index = 7
[_AnimatedEmissivePart] Index = 8
[_AnimatedEmissivePart] Index = 9
[_AnimatedEmissivePart] Index = 10
[_AnimatedEmissivePart] Index = 11
[_AnimatedEmissivePart] Index = 12
[_AnimatedEmissivePart] Index = 13
[_AnimatedEmissivePart] Index = 14
[_AnimatedEmissivePart] Index = 15
[_AnimatedEmissivePart] Index = 16
[_AnimatedEmissivePart] Index = 17
[_AnimatedEmissivePart] Index = 18
[_AnimatedEmissivePart] Index = 19
[_AnimatedEmissivePart] Index = 20
[_AnimatedEmissivePart] Index = 21
[_AnimatedEmissivePart] Index = 22
[_AnimatedEmissivePart] Index = 23
[_AnimatedEmissivePart] Index = 24
[_AnimatedEmissivePart] Index = 25
[_AnimatedEmissivePart] Index = 26
[_AnimatedEmissivePart] Index = 27
[_AnimatedEmissivePart] Index = 28
[_AnimatedEmissivePart] Index = 29
[_AnimatedEmissivePart] Index = 30
[_AnimatedEmissivePart] Index = 31
[_AnimatedEmissivePart] Index = 32
[_AnimatedEmissivePart] Index = 33
[_AnimatedEmissivePart] Index = 34
[_AnimatedEmissivePart] Index = 35
[_AnimatedEmissivePart] Index = 36
[_AnimatedEmissivePart] Index = 37
[_AnimatedEmissivePart] Index = 38
[_AnimatedEmissivePart] Index = 39
